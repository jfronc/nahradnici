---
title: "PSP"
format:
  html:
    page-layout: full
---

```{r echo = FALSE, warning = FALSE, message = FALSE, results = 'asis'}
xfun::pkg_attach("dplyr", "reactable", "crosstalk")

cz_date <- function(x) {
  x <- format(x, "%e. %m. %Y") |>
    stringr::str_replace("\\s0", " ")
  return(x)
}

candidates <- readRDS("../psp/data/candidates.rds") |>
  select(JMENO, PRIJMENI, VEK, POVOLANI, since, until, VOLKRAJ, NAZVOLKRAJ, KSTRANA, NAZ_STR, state)

# Create shared data object for Crosstalk filters
shared_candidates <- SharedData$new(candidates)

# Create linked filters
region_filter <- filter_select(
  id = "region",
  label = "Volební kraj",
  shared_candidates,
  group = ~NAZVOLKRAJ,
  multiple = FALSE
)

party_filter <- filter_select(
  id = "party",
  label = "Volební strana",
  shared_candidates,
  group = ~NAZ_STR,
  multiple = FALSE
)

# Create interactive reactable table
candidate_table <- reactable(
  shared_candidates,
  columns = list(
    JMENO = colDef(name = "Jméno"),
    PRIJMENI = colDef(name = "Příjmení"),
    VEK = colDef(name = "Věk", width = 50),
    POVOLANI = colDef(name = "Povolání", width = 350),
    since = colDef(name = "Mandát od", cell = cz_date),
    until = colDef(name = "Mandát do", cell = cz_date),
    VOLKRAJ = colDef(show = FALSE),
    NAZVOLKRAJ = colDef(show = FALSE),
    KSTRANA = colDef(show = FALSE),
    NAZ_STR = colDef(show = FALSE),
    state = colDef(show = FALSE)
  ),
  pagination = FALSE,
  highlight = TRUE,
  bordered = TRUE,
#  compact = TRUE,
  rowStyle = JS("
    function(rowInfo) {
      if (rowInfo.row.state == 11) {
        return { backgroundColor: '#e8f5e9' }  // poslanec od začátku
      } else if (rowInfo.row.state == 12) {
        return { backgroundColor: '#fcf988' }  // poslanec–náhradník
      } else if (rowInfo.row.state == 3) {
        return { backgroundColor: '#ffb8b0' }  // bývalý poslanec
      } else {
        return {}
      }
    }
  ")
)

# Arrange filters above the table
htmltools::tagList(
  htmltools::h4("Vyberte kraj a stranu"),
  region_filter,
  party_filter,
  candidate_table
)

```
